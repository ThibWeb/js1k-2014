function equalCoordinates(e,o){return e[0]==o[0]&&e[1]==o[1]}function init(){direction=nextDirection="r",snakePos=[[6,4],[5,4],[4,4]],score=0,frameInterval=99,document.onkeydown=function(e){var o=e.which,t=keysToDirections[o];t?(-1!==allowedDirections[direction].indexOf(t)&&(nextDirection=t),e.preventDefault()):32===o&&(clearTimeout(timeout),init())},loop()}function loop(){c.clearRect(0,0,width,height);var e=snakePos[0].slice();switch(direction=nextDirection){case"l":e[0]--;break;case"u":e[1]--;break;case"r":e[0]++;break;case"d":e[1]++}snakePos.unshift(e),equalCoordinates(snakePos[0],applePos)?(applePos=[random(widthInBlocks),random(heightInBlocks)],frameInterval*=.95,score++):snakePos.pop(),c.fillStyle="tomato",snakePos.forEach(function(e){c.fillRect(block*e[0],block*e[1],block,block)}),c.fillText(score,width-9,height-9),c.fillStyle="lime",c.beginPath();var o=block/2;c.arc(applePos[0]*block+o,applePos[1]*block+o,o,0,2*Math.PI,1),c.fill();var t=snakePos[0],i=t[0],n=t[1],a=0;snakePos.slice(1).forEach(function(e){equalCoordinates(t,e)&&(a=1)}),!i||i>widthInBlocks||!n||n>heightInBlocks||a||(timeout=setTimeout(loop,frameInterval))}function random(e){return Math.floor(Math.random()*e)-1}var score,timeout,frameInterval,width=a.width,height=a.height,block=10,widthInBlocks=width/block,heightInBlocks=height/block,snakePos=[],direction="r",nextDirection=direction,applePos=[6,6],keysToDirections={37:"l",38:"u",39:"r",40:"d"},allowedDirections={l:["u","d"],r:["u","d"],u:["l","r"],d:["l","r"]};init();